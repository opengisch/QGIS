<?xml version="1.0"?>
<!-- The package name -->
<typesystem package="core">
    <!-- Pre-defined typesystem that contains types used by our class.
        PySide has one typesystem for each module, so here we use only the
        Widgets typesystem because it already includes gui and core
        typesystems -->
    <load-typesystem name="typesystem_core.xml" generate="no"/>
    <load-typesystem name="typesystem_xml.xml" generate="no"/>
    <!--<load-typesystem name="typesystem_widgets.xml" generate="no"/>-->

    <!-- This is used in a public virtual pure function.
         We need to declare it otherwise shiboken will ignore the
         function and will fail to create a wrapper -->
    <!--<primitive-type name="DropAreaWithCentralFrame"/>-->

    <!-- Export our public enums and flags -->
    <!--<enum-type name="Location"/>-->

    <!-- Export our classes
         For classes we can use two types:
            object-type: class that does not have a copy-constructor
                         and cannot be passed as value to functions;
            value-type: class that can be passed as value for functions

         Here we only use 'object-type' since all our classes are
         derived from QWidget.
     -->

    <!-- DockWidgetBase contains an internal enum, so we declare it
         inside of the object-type -->

<!--
    <typedef-type name="QgsFeatureList" source="QList&lt;QgsFeature&gt;" />
-->

    <object-type name="QgsApplication">
      <modify-function signature="QgsApplication(int&amp;,char**,bool,QString,QString)" access="private"/>
      <add-function signature="QgsApplication(QStringList)">
        <inject-code>
<![CDATA[
    static int argc;
    static char **argv;
    PyObject *stringlist = PyTuple_GET_ITEM(pyargv, 0);
    if (Shiboken::listToArgcArgv(stringlist, &argc, &argv, "PySideApp")) {
        *cptr = new QgsApplicationWrapper(argc, argv, 0);
        Shiboken::Object::releaseOwnership(reinterpret_cast<SbkObject *>(self));
        PySide::registerCleanupFunction(&PySide::destroyQCoreApplication);
    }
]]>
        </inject-code>
      </add-function>
    </object-type>
    <object-type name="QgsWkbTypes" >
        <enum-type name="GeometryType"/>
        <enum-type name="Type"/>
    </object-type>

    <object-type name="QgsUnitTypes">
      <enum-type name="SystemOfMeasurement"/>
    </object-type>


@TYPESYSTEM_CONTENT@


    <object-type name="QgsMapLayer">
      <enum-type name="StyleCategory" flags="StyleCategories"/>
    </object-type>

    <value-type name="QgsExpressionContextScope">
    </value-type>

    <object-type name="QgsFeatureSink">
      <enum-type name="Flag" flags="Flags"/>
    </object-type>

    <value-type name="QgsGeometry">
        <add-function signature="__repr__" return-type="PyObject*">
            <inject-code class="target" position="beginning">
<![CDATA[
    QString str;
    if ( %CPPSELF->isNull() )
      str = QStringLiteral( "<QgsGeometry: null>" );
    else
    {
      QString wkt = %CPPSELF->asWkt();
      if ( wkt.length() > 1000 )
        wkt = wkt.left( 1000 ) + QStringLiteral( "..." );
      str = QStringLiteral( "<QgsGeometry: %1>" ).arg( wkt );
    }
    %PYARG_0 = PyUnicode_FromString( str.toUtf8().constData() );
]]>
            </inject-code>
        </add-function>
    </value-type>
<!--
    <value-type name="QgsInterval">
    </value-type>
-->

</typesystem>
